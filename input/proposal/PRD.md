# 네놈마켓 B2B 플랫폼 PRD (Product Requirements Document)

## 1. 프로젝트 개요

### 1.1 서비스명
네놈마켓 (B2B 도매/유통 플랫폼)

### 1.2 핵심 콘셉트
**AI 채팅 기반 B2B 유통 관리 플랫폼**
- 메인 인터페이스: AI 채팅 (자연어로 업무 처리)
- 보조 인터페이스: 웹 대시보드 (직접 조작/조회)
- 대상 품목: 농산물, 수산물, 축산물 (가격 변동 빈번)

### 1.3 사용자 역할

| 역할 | 설명 | 시스템 접근 |
|------|------|------------|
| **플랫폼 관리자** | 네놈마켓 운영자. 전체 관리 | 웹 + AI 채팅 |
| **셀러** | 쿠팡/스마트스토어 등에서 판매하는 판매자 | 웹 + AI 채팅 (권한 제한) |
| **공급사** | 상품 공급 업체 | 시스템 외부 (카톡/엑셀) |

---

## 2. 사용자별 기능 요구사항

### 2.1 플랫폼 관리자

#### 상품 관리
- [x] 상품 수동 등록 (개별)
- [x] 상품 엑셀 대량 등록
- [x] 상품 가격 빠른 수정 (개별/일괄)
- [x] 등급별 차등 가격 설정
- [x] 특정 셀러별 개별 가격 설정
- [x] 상품 상태 관리 (판매중/품절/단종)
- [x] 재고 수량 관리
- [ ] 재고 부족 시 자동 알림

#### 주문 관리
- [x] 셀러 주문 접수 확인
- [x] 주문 취합 (공급사별/상품별)
- [x] 공급사 양식 맞춤 발주서 엑셀 다운로드
- [ ] 공급사 송장 엑셀 업로드 → 주문별 자동 매칭
- [x] 자체 상품 직접 송장 입력
- [x] 주문 상태 변경 (준비중/배송중/배송완료)

#### 배송 관리
- [ ] 공급사 상품: 송장 엑셀 업로드 방식
- [ ] 자체 상품 배송 (3가지 방식)
  - 택배사 API 연동 (CJ대한통운 등) - 기본
    - 집하 요청
    - 송장번호 자동 수신
    - 주문에 자동 반영
  - [x] 송장번호 엑셀 일괄 등록 - 수동
  - [x] 송장번호 개별 직접 입력 - 수동
- [ ] 배송 추적

#### 회원 관리
- [x] 셀러 가입 신청 승인/반려 (사업자등록증 확인)
- [x] 셀러 등급 관리 (등급 생성/수정/삭제)
- [x] 등급별 수수료율 설정
- [x] 개별 셀러 수수료율 설정 (등급 무관)
- [x] 셀러 정보 관리

#### 정산/매출 관리
- [ ] 셀러별 매출 집계
- [ ] 수수료 자동 계산 (등급 수수료 or 개별 수수료)
- [ ] 반품/환불 금액 정산 반영
- [ ] 마진율 관리
- [ ] 통계 대시보드 (페이지 존재, API 미구현)
  - 일별/주별/월별 매출 통계 (총매출, 순매출)
  - 상품별/카테고리별 판매량 통계
  - 셀러별 주문수/매출/수수료 통계
  - 상품별 판매량 Top N, 매출 Top N
  - 주문 상태별 현황 (대기/배송중/완료/클레임)
  - 기간별 비교 차트
- [ ] 정산 내역 엑셀 다운로드

#### C/S 관리
- [ ] 게시판 문의 확인/답변 (페이지 존재, API 미구현)
- [ ] 클레임 관리 (페이지 존재, API 미구현)
  - 셀러 요청 접수
  - 승인/처리
  - 정산 자동 반영
  - 교환 시 재배송 + 송장 재입력

#### 공급사 관리
- [x] 공급사 정보 등록 (업체명, 연락처 등)
- [ ] 공급사별 발주 엑셀 양식 템플릿 관리
- [x] 발주/입고 이력 관리

#### 알림/공지
- [ ] 셀러 전체 공지사항 발송 (페이지 존재, API 미구현)
- [ ] 가격 변동/품절 안내
- [ ] 카카오 알림톡 연동

#### 관리자 권한
- [ ] 슈퍼 관리자 / 일반 관리자 권한 분리 (역할 구분만 존재, 권한 차이 미구현)
- [ ] 활동 로그 (모델 존재, 기록 로직 미구현)

### 2.2 셀러

#### 상품 조회
- [x] 판매 가능 상품 리스트 조회 (등급별 가격 반영)
- [x] 상품 리스트 엑셀 다운로드

#### 주문 관리
- [ ] 주문 업로드 (양식 상관없이 AI가 컬럼 자동 인식)
  - 어떤 엑셀이든 올리면 AI가 컬럼 매핑 (쿠팡/스마트스토어/합친 것 무관)
  - [x] 건건이 수동 입력도 가능
- [x] 내 주문 현황 조회
- [x] 송장번호 확인 (입력되면 바로 확인 가능)
- [x] 주문 상태 확인

#### 클레임
- [ ] 반품/환불/교환 요청 등록 (페이지 존재, API 미구현)
- [ ] 클레임 진행 상태 확인 (페이지 존재, API 미구현)

#### 회원가입
- [x] 회원가입 시 사업자등록증 첨부 필수
- [x] 관리자 승인 후 이용 가능

#### 내 통계
- [ ] 내 매출 통계 (페이지 존재, API 미구현)
- [ ] 내 상품별 판매량/금액
- [ ] 내 주문 상태별 현황
- [ ] 월별 주문수/매출 추이 차트

#### 기타
- [ ] 게시판 문의 작성 (페이지 존재, API 미구현)
- [ ] 내 정산 내역 조회 (페이지 존재, API 미구현)
- [ ] 알림 수신 (송장 입력됨, 가격 변동 등)
- [ ] AI 채팅으로 업무 처리 (권한 범위 내)

---

## 3. AI 채팅 인터페이스

### 3.1 개요
웹 대시보드 우측에 상시 표시되는 AI 채팅창. 자연어로 대부분의 업무 처리 가능.
관리자와 셀러 모두 AI 채팅을 사용하며, 역할에 따라 명령 가능한 범위가 다름.

### 3.2 역할별 AI 채팅 권한

| 기능 | 관리자 | 셀러 |
|------|:------:|:----:|
| 상품 등록/수정/가격변경 | O | X |
| 상품 조회/다운로드 | O | O |
| 주문 전체 조회 | O | 본인 것만 |
| 주문 엑셀 업로드 | O | O (채팅에서 파일 첨부) |
| 주문 정보 검색 (송장번호/고객명) | O | O (본인 주문) |
| 송장 파일 다운로드 (업로드한 주문 기준) | O | O (본인 주문) |
| 발주서 생성/다운로드 (공급사용) | O | X |
| 송장 엑셀 업로드 (공급사 회신) | O | X |
| 송장 조회 | O | O (본인 주문) |
| 정산 조회 | O (전체) | O (본인) |
| 통계 조회 | O (전체) | O (본인 통계) |
| 클레임 승인/처리 | O | 요청만 |
| 공지 발송 | O | X |
| 배송 추적 | O | O (본인 주문) |
| 재고 조회 | O | O (읽기만) |

### 3.3 셀러 AI 채팅 사용 예시

```
셀러: "주문 업로드할게" + 📎쿠팡_주문.xlsx
🤖: 쿠팡 주문 15건 인식했습니다. 등록할까요?
셀러: "응"
🤖: 15건 등록 완료!

셀러: "오늘 올린 주문 중에 송장 들어온 거 있어?"
🤖: 15건 중 8건 송장 입력됨. 7건 대기 중.
   📎 송장입력완료_20260226.xlsx (다운로드)

셀러: "홍길동 고객 주문 정보 알려줘"
🤖: 홍길동 고객 주문 2건:
   - ORD-1234: 제주감귤 5kg / 송장: 1234567890 (배송중)
   - ORD-1235: 한라봉 3kg / 송장 대기중

셀러: "송장번호 1234567890 주문 보여줘"
🤖: ORD-1234 상세:
   수취인: 홍길동 / 010-1234-5678
   상품: 제주감귤 5kg x 1
   송장: CJ대한통운 1234567890 (배송중 - 대전허브 통과)

셀러: "이번 주 올린 주문 전체 송장 파일 다운로드"
🤖: 📎 이번주_송장현황_20260226.xlsx
   총 45건: 송장완료 38건 / 대기 7건
```

### 3.3 지원 기능

#### 파일 처리
- 엑셀 업로드 (주문, 송장, 상품, 발주서)
- 엑셀 다운로드 (발주서, 정산, 상품 리스트)
- AI가 엑셀 컬럼 자동 인식/매핑

#### 자연어 명령 예시
```
"주문 발주서 업로드해줘" + 📎파일
"CJ공급사 발주서 뽑아줘"
"오늘 주문 현황 알려줘"
"상품A 가격 12,000원으로 변경해줘"
"감귤류 전체 10% 인상해줘"
"김셀러 이번 달 정산 내역 보여줘"
"반품 요청 들어온 거 있어?"
"지난 주 가장 많이 팔린 상품 Top 5"
"전체 공지 보내줘: 내일 감귤 가격 인상됩니다"
```

#### 자동 알림 (AI → 관리자)
- 송장번호 입력 시 자동 파일 생성 알림
- 새 주문 접수 알림
- 재고 부족 알림
- 이상 탐지 (주문 급증, 높은 반품률, 발주 미수신 등)
- 택배사 송장 발급 완료 알림

#### 셀러 문의 AI 1차 응답
- 배송 추적 자동 조회
- 재고 확인 자동 응답
- 복잡한 문의는 관리자에게 에스컬레이션

---

## 4. 핵심 비즈니스 플로우

### 4.1 주문 → 배송 완료 (공급사 상품)
```
셀러 주문 엑셀 업로드
→ 플랫폼에 주문 등록
→ 관리자 확인
→ 공급사별 주문 취합
→ 공급사 양식 발주서 엑셀 다운로드
→ 카톡으로 공급사에게 전달
→ 공급사가 송장 엑셀 회신 (카톡)
→ 관리자가 송장 엑셀 업로드
→ 주문별 송장 자동 매칭 + 상태 "배송중"
→ 셀러 주문 페이지에 송장 반영
→ 셀러가 자기 판매 채널에 송장 입력
```

### 4.2 주문 → 배송 완료 (자체 상품)
```
셀러 주문 엑셀 업로드
→ 플랫폼에 주문 등록
→ 관리자 확인
→ 택배사 API로 집하 요청
→ 택배사에서 송장번호 자동 반환
→ 주문에 자동 반영 + 상태 "배송중"
→ 셀러에게 알림
```

### 4.3 클레임 처리
```
셀러 클레임 요청 (반품/환불/교환)
→ 관리자 확인/승인
→ 처리 (반품수거/환불/교환발송)
→ 정산에 반영
→ 셀러에게 상태 반영
```

---

## 5. 기술 스택

| 구분 | 기술 |
|------|------|
| Framework | Next.js 15 (App Router) |
| Language | TypeScript |
| UI | Tailwind CSS + shadcn/ui |
| DB | PostgreSQL |
| ORM | Prisma |
| 인증 | NextAuth.js |
| AI | Claude API (자연어 처리) |
| 실시간 | WebSocket (채팅) |
| 파일처리 | xlsx 라이브러리 (엑셀) |
| 배포 (웹) | Vercel (→ 추후 AWS ECS 전환 용이) |
| 배포 (채팅) | Railway or Render (WebSocket 서버) → 추후 AWS EC2 |
| DB | Supabase PostgreSQL (→ 추후 AWS RDS) |
| 파일 스토리지 | Supabase Storage (→ 추후 AWS S3) |
| 택배 API | CJ대한통운 API |
| 알림 | 카카오 알림톡 API |

---

## 6. 개발 Phase

### Phase 1: 기반 구축
- DB 스키마 설계 및 마이그레이션
- 인증 시스템 (관리자/셀러 로그인, 회원가입 승인)
- 등급/수수료 시스템
- 프로젝트 기본 레이아웃

### Phase 2: 핵심 기능 API
- 상품 CRUD + 엑셀 업/다운로드
- 주문 CRUD + 엑셀 업로드
- 송장 매칭 로직
- 공급사 발주서 엑셀 생성
- 재고 관리

### Phase 3: 웹 대시보드
- 관리자 대시보드 (상품/주문/배송/회원/정산/CS)
- 셀러 대시보드 (상품조회/주문/송장/정산/클레임)
- 반응형 UI

### Phase 4: AI 채팅 인터페이스
- 채팅 UI (대시보드 우측)
- Claude API 연동 (자연어 → 기능 실행)
- 파일 업로드/다운로드 in 채팅
- 자동 알림 시스템

### Phase 5: 고급 기능
- 택배사 API 연동
- AI 엑셀 자동 매핑
- 이상 탐지
- 카카오 알림톡
- 셀러 문의 AI 1차 응답

### Phase 6: 안정화 & 배포
- 테스트
- 보안 점검
- 운영 배포
